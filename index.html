<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galeri Video MPU3411</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* --- CSS MODEN & GRID --- */
        :root {
            --bg-gradient: linear-gradient(135deg, #1f4037 0%, #99f2c8 100%);
            --card-bg: #ffffff;
            --primary: #1f4037;
            --accent: #2ecc71;
        }

        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
        }

        /* HEADER */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.9);
            padding: 15px 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        h1 { margin: 0; font-size: 1.5rem; color: var(--primary); }

        /* BUTANG UTAMA */
        .btn-upload {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .btn-upload:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4); }

        /* GRID VIDEO (SUSUN ATUR KOTAK) */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); /* Responsif */
            gap: 20px;
            padding-bottom: 50px;
        }

        .video-card {
            background: var(--card-bg);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
        }

        .video-card:hover { transform: translateY(-5px); }

        /* TUMBNAIL AREA */
        .thumbnail-box {
            height: 160px;
            background: #000;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .thumbnail-box img { width: 100%; height: 100%; object-fit: cover; opacity: 0.8; }
        .play-icon {
            position: absolute;
            font-size: 3rem;
            color: rgba(255,255,255,0.8);
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        /* INFO AREA */
        .card-info { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; }
        .card-tag { 
            font-size: 0.75rem; font-weight: bold; 
            color: var(--accent); text-transform: uppercase; margin-bottom: 5px;
        }
        .card-title { font-size: 1rem; font-weight: bold; margin: 0 0 10px 0; color: #333; line-height: 1.4; }
        .card-note { font-size: 0.85rem; color: #666; margin-bottom: 15px; flex-grow: 1; }
        
        .btn-watch {
            background: var(--primary);
            color: white;
            text-decoration: none;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        /* MODAL POPUP (UNTUK MUAT NAIK) */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: none; /* Tersembunyi */
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown { from {transform: translateY(-50px); opacity:0;} to {transform: translateY(0); opacity:1;} }

        .close-btn {
            position: absolute; top: 15px; right: 20px;
            font-size: 1.5rem; cursor: pointer; color: #999;
        }

        /* INPUT STYLES DALAM MODAL */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem; }
        select, input, textarea {
            width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;
            box-sizing: border-box; font-family: inherit;
        }
        
        .loader { display: none; text-align: center; margin-top: 10px; }
    </style>
</head>
<body>

    <header>
        <div>
            <h1><i class="fas fa-running"></i> MoVO MPU3411</h1>
            <small style="color:#666">Modul Pengajaran Olahraga</small>
        </div>
        <button class="btn-upload" onclick="bukaModal()">
            <i class="fas fa-plus-circle"></i> Muat Naik
        </button>
    </header>

    <div id="gallery" class="video-grid">
        <p style="text-align:center; color:white; grid-column: 1/-1;">Sedang memuatkan galeri...</p>
    </div>

    <div id="uploadModal" class="modal-overlay">
        <div class="modal-content">
            <span class="close-btn" onclick="tutupModal()">&times;</span>
            <h2 style="margin-top:0; color: var(--primary);">Tambah Video Baru</h2>
            
            <div class="form-group">
                <label>Topik / Acara:</label>
                <select id="topik">
                    <option value="" disabled selected>-- Pilih Topik --</option>
                    <optgroup label="1.0 Pengenalan"><option value="1.0 Pengenalan">1.0 Pengenalan Olahraga</option></optgroup>
                    <optgroup label="2.0 Kepegawaian"><option value="2.0 Kepegawaian">2.0 Kepegawaian</option></optgroup>
                    <optgroup label="3.0 Balapan">
                        <option value="3.1 Lari Pecut">3.1 Lari Pecut</option>
                        <option value="3.2 Lari Berganti">3.2 Lari Berganti-ganti</option>
                        <option value="3.3 Lari Berpagar">3.3 Lari Berpagar</option>
                    </optgroup>
                    <optgroup label="4.0 Padang">
                        <option value="4.1 Lontar Peluru">4.1 Lontar Peluru</option>
                        <option value="4.2 Lompat Jauh">4.2 Lompat Jauh</option>
                        <option value="4.3 Lompat Tinggi">4.3 Lompat Tinggi</option>
                    </optgroup>
                    <optgroup label="5.0 Pengurusan"><option value="5.0 Trek">5.0 Penyediaan Trek</option></optgroup>
                </select>
            </div>

            <div class="form-group">
                <label>Pautan Video (YouTube/Drive):</label>
                <input type="url" id="videoLink" placeholder="https://..." required>
            </div>

            <div class="form-group">
                <label>Tajuk / Catatan Ringkas:</label>
                <textarea id="catatan" rows="3" placeholder="Contoh: Teknik hayunan tangan yang betul"></textarea>
            </div>

            <button class="btn-upload" style="width:100%; justify-content:center;" onclick="hantarData()">
                Simpan Video
            </button>
            <div id="loader" class="loader">Sedang menyimpan data...</div>
        </div>
    </div>

    <script>
        // ==========================================
        // TEPEK URL APPS SCRIPT ANDA DI SINI
        // ==========================================
        const WEB_APP_URL = "MASUKKAN_URL_GOOGLE_APPS_SCRIPT_ANDA_DI_SINI"; 

        // Fungsi Buka/Tutup Modal
        function bukaModal() { document.getElementById('uploadModal').style.display = 'flex'; }
        function tutupModal() { document.getElementById('uploadModal').style.display = 'none'; }

        // Fungsi Simpan Data
        function hantarData() {
            const topik = document.getElementById('topik').value;
            const link = document.getElementById('videoLink').value;
            const catatan = document.getElementById('catatan').value;
            const loader = document.getElementById('loader');

            if(!topik || !link || !catatan) { alert("Sila isi semua maklumat."); return; }
            
            loader.style.display = 'block';

            fetch(WEB_APP_URL, {
                method: "POST",
                body: new URLSearchParams({ "action": "insert", "topik": topik, "link": link, "catatan": catatan })
            })
            .then(res => res.json())
            .then(data => {
                loader.style.display = 'none';
                if(data.result === 'success') {
                    alert("Berjaya!");
                    tutupModal();
                    // Kosongkan form
                    document.getElementById('videoLink').value = "";
                    document.getElementById('catatan').value = "";
                    muatTurunData(); // Refresh grid
                } else {
                    alert("Ralat: " + data.error);
                }
            });
        }

        // Fungsi Hasilkan Tumbnail Pintar
        function getThumbnail(url) {
            // Cuba cari ID YouTube
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);

            if (match && match[2].length === 11) {
                // Jika YouTube, guna gambar sebenar
                return `<img src="https://img.youtube.com/vi/${match[2]}/mqdefault.jpg" alt="Video Thumb"> <i class="fas fa-play-circle play-icon"></i>`;
            } else {
                // Jika Google Drive/Lain-lain, guna ikon generik
                return `<div style="background:#333; width:100%; height:100%; display:flex; justify-content:center; align-items:center;">
                            <i class="fas fa-file-video play-icon"></i>
                        </div>`;
            }
        }

        // Fungsi Tarik Data & Buat Grid
        function muatTurunData() {
            const gallery = document.getElementById('gallery');
            
            fetch(WEB_APP_URL)
            .then(res => res.json())
            .then(response => {
                gallery.innerHTML = ""; // Bersihkan loading text
                const data = response.data;

                if (data.length === 0) {
                    gallery.innerHTML = '<p style="text-align:center; color:white; grid-column: 1/-1;">Tiada video dijumpai. Tekan butang "Muat Naik" di atas.</p>';
                    return;
                }

                data.reverse().forEach(item => {
                    const thumbHTML = getThumbnail(item.link);
                    
                    const card = document.createElement('div');
                    card.className = 'video-card';
                    card.innerHTML = `
                        <div class="thumbnail-box">
                            ${thumbHTML}
                        </div>
                        <div class="card-info">
                            <div class="card-tag">${item.topik}</div>
                            <h3 class="card-title">${item.catatan}</h3> 
                            <div class="card-note"></div>
                            <a href="${item.link}" target="_blank" class="btn-watch">Tonton Sekarang</a>
                        </div>
                    `;
                    gallery.appendChild(card);
                });
            })
            .catch(error => {
                gallery.innerHTML = '<p style="color:white;">Gagal memuat turun data.</p>';
            });
        }

        // Auto load
        window.onload = muatTurunData;

        // Tutup modal bila klik luar kotak
        window.onclick = function(event) {
            const modal = document.getElementById('uploadModal');
            if (event.target == modal) { tutupModal(); }
        }
    </script>
</body>
</html>
